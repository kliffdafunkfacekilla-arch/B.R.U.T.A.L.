# **Narrative Injection Templates**

This document details the prompt structures used by the **Narrative Generator Agent** (Micro Layer) to combine raw data with the SessionContext created in the previous step.

## **The "Onion Skin" Prompting Strategy**

We construct the prompt in layers to ensure the AI considers Mechanics, Lore, and Atmosphere in order.

### **Template: Room Description (On Entry)**

**System Instruction:**

You are an expert Dungeon Master. Describe the scene to the players.

1. Start with the **Sensory Atmosphere** (Smell, Light, Sound).  
2. Describe the **Geometry/Layout** (Exits, Size).  
3. Highlight **Interactive Entities** (Monsters, Loot).  
4. Weave in **Lore Clues** subtly (do not dump info, show evidence of it).

**Context Block (Injected from JSON):**

{  
  "Current Room": "Room 4 (The Shrine)",  
  "Atmosphere": {  
    "Lighting": "Dim purple glow from the walls",  
    "Smell": "Ozone and rot"  
  },  
  "Entities": \["Goblin Shaman (Hostile)"\],  
  "Geometry": "30ft circular room, Exit North",  
  "Active Lore": "Magic is powered by blood."  
}

**Output Example (What the TTS reads):**

"As you push past the heavy stone door, the smell of **ozone and rot** hits you instantly. The room is a **30-foot circle**, bathed in a **dim purple glow** that seems to pulse from the walls themselves. In the center, you see a **Goblin Shaman** kneeling over a fresh stain on the floorâ€”evidence that **magic here demands a blood price**. He looks up, snarling. There is a single exit to the **North**."

### **Template: The "Lore Check" (Passive Insight)**

When a player asks "What do I know about this place?" or rolls high Intelligence.

**System Instruction:**

The player is analyzing the environment. Check the SessionContext.local\_history.

* If the info is is\_secret=False, reveal it.  
* If is\_secret=True, check if they met the DC.  
* Frame the answer as a memory or deduction.

**Input:**

* Player Roll: 18 (Success)  
* Nearby Lore: "The Elves vanished in the Red Year." (Tag: elf)

**Output Example:**

"Looking at the crumbling architecture, you recognize the masonry. It's distinctively Elven, but unfinished. You recall the histories of the **Red Year**, when the entire Elven civilization vanished overnight. It looks like the masons dropped their tools right here and never returned."

### **Template: Dynamic Object Interaction**

When a player interacts with a specific item generated by the Loot Table.

**System Instruction:**

The player inspects \[Item Name\].

1. Describe its physical appearance.  
2. Link it to \[Faction\] if applicable.  
3. Hint at its function.

**Input:**

* Item: "Rusted Dagger"  
* Faction Override: "Cult of Worms" (Context: Dungeon is a cult base)

**Output Example:**

"It looks like a standard rusted dagger at first, but as you wipe away the grime, you see the hilt is carved from bone. A small symbol is etched into the blade: a twisting, eyeless worm. This isn't just junk; it's a ceremonial blade of the **Cult of Worms**."

## **The Workflow for Content Injection**

graph LR  
    Step1\[Room Node JSON\] \--\>|Raw Data| Assembler  
    Step2\[Lore Context\] \--\>|Theme/History| Assembler  
    Step3\[Atmosphere\] \--\>|Senses| Assembler  
      
    Assembler \--\>|Combined Prompt| LLM  
    LLM \--\>|Prose| TTS\[Text to Speech\]  
